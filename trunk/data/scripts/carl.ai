// Note: This still needs to be ported to lua


var bsizx,bsizy,cpud1;

function main() {
  var i,alti,j,factor,direct,
      jmpattack,touchcnt,x,y,delay,bx,by,vbx,vby;

  bsizx=64;
  bsizy=64;

  j=side();
  factor=j*2-1;
  
  delay=0;
  while (1) {
    stop();
    stopjump();

    bx=ballx();
    by=bally();
    vbx=bspeedx();
    vby=bspeedy();
    touchcnt=touches();
    x=posx();
    y=posy();

    direct=1;

    i=estimate(200);
    jmpattack=0;

    if (i>-9000) {
      alti=i;
      
      if ((bx-400)*-factor>abs(vbx)*4) {
        //block
        jmpattack=1;
        i=400;
      }
      if (abs(i-400)>100) {
        i=estimate(350);
        if ((i<-9000) || (by<300) || (touchcnt>1)) {
          i=alti;
        } else {
          jmpattack=1;
        }
      }
      
              
      if (j==1) {
        if (i<500) {
          if (touchcnt<2) {
            i=i-bsizx /2;
          }
        }
      } else {    
        if (i>300) {
          if (touchcnt<2) {
            i=i+bsizx /2;
          }
        }
      }

      if ((ballx()-400)*factor<-100) i=400+factor*200;

      i=i+(bsizx / 3)*factor;

      //if (i>=x+7) right();
      //if (i<=x-7) left();
      moveto(i);
    }
    stopjump();
    if(vby<=10)
      if (factor*(x-bx)<21) 
        if (factor*(bx-x)<7)
          if (abs(bx-x)<120)
            if (abs(vby)<65)
              if (by>200)
                if (by-y>70)
                  if ((by<400) || (vby==0))
                    if (abs(vbx)<20)
                      if (!balldown()) jump();
    if (random(300)==0) jump();
    if (i>-9000) {
      if (jmpattack) {
        i=i+factor*5;                                 
        if ((abs(i-x)<45) && (by>250) && (abs(x-bx)<abs(vbx)) && (by<600)) {
          jump();
        }
      }
    }
    if (touching()) {
      stop();
    }
      
    if (!launched()) {
      delay+=1;
      stopjump();
      if (delay>=30) jump();
    }
    debug(i);
    wait();
  }  //while
}  //function

