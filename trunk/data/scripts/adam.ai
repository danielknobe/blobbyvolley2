bsizx=64
bsizy=64

j=side()
factor=j*2-1
  
delay=0

cpud1 = 0

function step()
    stop()
    stopjump()

    bx=ballx()
    by=bally()
    vbx=bspeedx()
    vby=bspeedy()
    touchcnt=touches()
    x=posx()
    y=posy()

    direct=1

    i=estimate(200)

    if (i>-9000) then
      alti=i
                    
      if (j==1) then
        if (i<500) then
          if (touchcnt<2) then
            i=i-bsizx / 2
          end
        end
      else
        if (i>300) then
          if (touchcnt<2) then
            i=i+bsizx /2
          end
        end
      end

      i=i+(bsizx / 3)*factor
      
      if (cpud1 >0) then
        i=400+factor*200
        cpud1 = cpud1 - 1
      end
      if (vby>0) then
        cpud1=random(7)+7
      end
      
      -- if (i>=x+7) right();
      -- if (i<=x-7) left();
      moveto(i)
    end
    stopjump()
    if(vby<=10) then
      if (factor*(x-bx)<21) then
        if (factor*(bx-x)<7) then
          if (abs(bx-x)<120) then
            if (abs(vby)<65) then
              if (by>200) then
                if (by-y>70) then
                  if ((by<400) or (vby==0)) then
                    if (abs(vbx)<20) then 
                      if (not balldown()) then
                        jump()
                      end
                    end
                  end
                end
              end
            end
          end
        end
      end
    end
                      
    if (random(300)==0) then jump() end
    if (i>-9000) then
      if ((abs(i-x)>75) and (abs(bx-x)<65) and (vby<0) ) then
        jump()
      end
    end
    
    if (touching()) then
      stop()
    end
    
    if not launched() then
      delay = delay + 1
      stopjump()
      if (delay>=30) then 
        jump()
      end
    end
end
